<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SzczegÃ³Å‚y wizyty</title>

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">

<style>
body {
    padding: 30px;
}
.section {
    margin-bottom: 40px;
}
.table th {
    background: #f5f5f5;
}
.header-actions {
    margin-bottom: 20px;
}
</style>
</head>
<body>

<div class="container">

<div class="header-actions">
    <button class="btn btn-default" onclick="window.print()">ğŸ–¨ Drukuj</button>
    <button class="btn btn-danger" onclick="window.close()">âœ– Zamknij okno</button>
</div>

<!-- ===================== -->
<!-- SZCZEGÃ“ÅY WIZYTY -->
<!-- ===================== -->

<div class="section">
    <h3>ğŸ“‹ SzczegÃ³Å‚y wizyty</h3>
   <table class="table table-bordered">

    <tr>
        <th>ID</th>
        <td>{{ appointment.id }}</td>
    </tr>

    <tr>
        <th>Status</th>
        <td>
            {% if appointment.status == "scheduled" %}
                <span class="label label-primary">Zaplanowana</span>
            {% elif appointment.status == "completed" %}
                <span class="label label-success">Zrealizowana</span>
            {% elif appointment.status == "cancelled" %}
                <span class="label label-danger">Anulowana</span>
            {% else %}
                {{ appointment.status }}
            {% endif %}
        </td>
    </tr>

    <tr>
        <th>Typ wizyty</th>
        <td>
            {% if visit_type %}
                {{ visit_type.name }}
            {% else %}
                {{ appointment.visit_type }}
            {% endif %}
        </td>
    </tr>

    <tr>
        <th>Start</th>
        <td>{{ appointment.start.strftime("%d.%m.%Y %H:%M") }}</td>
    </tr>

    <tr>
        <th>Koniec</th>
        <td>{{ appointment.end.strftime("%d.%m.%Y %H:%M") }}</td>
    </tr>

    <tr>
        <th>Czas trwania</th>
        <td>{{ appointment.duration }} min</td>
    </tr>

    <tr>
        <th>ImiÄ™</th>
        <td>{{ appointment.patient_first_name }}</td>
    </tr>

    <tr>
        <th>Nazwisko</th>
        <td>{{ appointment.patient_last_name }}</td>
    </tr>

    <tr>
        <th>Telefon</th>
        <td>{{ appointment.patient_phone }}</td>
    </tr>

    <tr>
        <th>Email</th>
        <td>{{ appointment.patient_email or '-' }}</td>
    </tr>

    <tr>
        <th>Utworzona przez</th>
        <td>
            {% if appointment.created_by == "patient" %}
                ğŸ‘¤ Pacjent
            {% elif appointment.created_by == "doctor" %}
                ğŸ©º Lekarz
            {% else %}
                {{ appointment.created_by }}
            {% endif %}
        </td>
    </tr>

    <tr>
        <th>Data utworzenia</th>
        <td>{{ appointment.created_at.strftime("%d.%m.%Y %H:%M") }}</td>
    </tr>

    <tr>
        <th>IP klienta</th>
        <td>{{ appointment.client_ip or '-' }}</td>
    </tr>

</table>

</div>

<hr>

<h3>ğŸ’³ Informacje o pÅ‚atnoÅ›ci</h3>

{% if latest_payment %}

  <p>
    <strong>Metoda pÅ‚atnoÅ›ci:</strong>
    {% if latest_payment.provider == "przelewy24" %}
      ğŸ’³ Przelewy24 (online)
    {% elif latest_payment.provider == "manual_transfer" %}
      ğŸ¦ Przelew tradycyjny
    {% else %}
      ğŸ’° PÅ‚atnoÅ›Ä‡ w gabinecie
    {% endif %}
  </p>

  <p>
    <strong>Status pÅ‚atnoÅ›ci:</strong>
    {% if latest_payment.status == "paid" %}
      <span class="label label-success">OpÅ‚acona</span>
    {% elif latest_payment.status == "pending" %}
      <span class="label label-warning">Oczekuje</span>
    {% elif latest_payment.status == "init" %}
      <span class="label label-info">Zainicjowana</span>
    {% elif latest_payment.status == "failed" %}
      <span class="label label-danger">Nieudana</span>
    {% elif latest_payment.status == "cancelled" %}
      <span class="label label-default">Anulowana</span>
    {% else %}
      {{ latest_payment.status }}
    {% endif %}
  </p>

  <p>
    <strong>Kwota:</strong>
    {{ (latest_payment.amount / 100) | round(2) }} {{ latest_payment.currency }}
  </p>

  <p>
    <strong>Data utworzenia:</strong>
    {{ latest_payment.created_at }}
  </p>

  {% if latest_payment.paid_at %}
    <p>
      <strong>Data opÅ‚acenia:</strong>
      {{ latest_payment.paid_at }}
    </p>
  {% endif %}

{% else %}

  <p>
    <strong>Metoda pÅ‚atnoÅ›ci:</strong>  ğŸ’µ PÅ‚atnoÅ›Ä‡ w gabinecie
  </p>

  <p>
    <strong>Status:</strong>
    {% if appointment.status == "completed" %}
      <span class="label label-success">Zrealizowana</span>
    {% else %}
      <span class="label label-default">Brak pÅ‚atnoÅ›ci online</span>
    {% endif %}
  </p>

{% endif %}


<!-- ===================== -->
<!-- SMS -->
<!-- ===================== -->

<div class="section">
    <h3>ğŸ“© Historia SMS</h3>

    {% if sms_list %}
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Typ</th>
                <th>Status</th>
                <th>Telefon</th>
                <th>TreÅ›Ä‡</th>
                <th>BÅ‚Ä…d</th>
                <th>Utworzono</th>
                <th>WysÅ‚ano</th>
            </tr>
        </thead>
        <tbody>
            {% for sms in sms_list %}
            <tr>
                <td>{{ sms.id }}</td>
                <td>{{ sms.type }}</td>
                <td>{{ sms.status }}</td>
                <td>{{ sms.phone }}</td>
                <td style="max-width:300px; white-space: pre-wrap;">
                    {{ sms.content }}
                </td>
                <td>{{ sms.error_message or '-' }}</td>
                <td>{{ sms.created_at }}</td>
                <td>{{ sms.sent_at or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>Brak wysÅ‚anych SMS dla tej wizyty.</p>
    {% endif %}
</div>

<!-- ===================== -->
<!-- EMAIL -->
<!-- ===================== -->

<div class="section">
    <h3>ğŸ“§ Historia maili</h3>

    {% if emails %}
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Typ</th>
                <th>Status</th>
                <th>Do</th>
                <th>Temat</th>
                <th>BÅ‚Ä…d</th>
                <th>Utworzono</th>
                <th>WysÅ‚ano</th>
            </tr>
        </thead>
        <tbody>
            {% for mail in emails %}
            <tr>
                <td>{{ mail.id }}</td>

                <td>{{ mail.type }}</td>

                <td>
                    {% if mail.status == "sent" %}
                        <span class="label label-success">WysÅ‚any</span>
                    {% elif mail.status == "failed" %}
                        <span class="label label-danger">BÅ‚Ä…d</span>
                    {% elif mail.status == "pending" %}
                        <span class="label label-warning">Oczekuje</span>
                    {% else %}
                        {{ mail.status }}
                    {% endif %}
                </td>

                <td>{{ mail.recipient }}</td>

                <td style="max-width:250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    {{ mail.subject }}
                </td>

                <td>{{ mail.error_message or '-' }}</td>

                <td>{{ mail.created_at }}</td>

                <td>{{ mail.sent_at or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>Brak wysÅ‚anych maili dla tej wizyty.</p>
    {% endif %}
</div>


<!-- ===================== -->
<!-- PÅATNOÅšCI -->
<!-- ===================== -->

<div class="section">
    <h3>ğŸ’³ Historia pÅ‚atnoÅ›ci</h3>

    {% if payments %}
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Provider</th>
                <th>Status</th>
                <th>Kwota</th>
                <th>Waluta</th>
                <th>Session ID</th>
                <th>Order ID</th>
                <th>Utworzono</th>
                <th>ZapÅ‚acono</th>
            </tr>
        </thead>
        <tbody>
            {% for p in payments %}
            <tr>
                <td>{{ p.id }}</td>
                <td>{{ p.provider }}</td>
                <td>{{ p.status }}</td>
                <td>{{ "%.2f"|format(p.amount / 100) }}</td>
                <td>{{ p.currency }}</td>
                <td>{{ p.provider_session_id }}</td>
                <td>{{ p.provider_order_id or '-' }}</td>
                <td>{{ p.created_at }}</td>
                <td>{{ p.paid_at or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>Brak pÅ‚atnoÅ›ci dla tej wizyty.</p>
    {% endif %}
</div>

</div>

</body>
</html>
